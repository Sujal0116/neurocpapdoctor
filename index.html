<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NeuroCPAP Doctor Dashboard</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/4.4.3/chart.umd.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        /* [KEEP ALL PREVIOUS STYLES - JUST ADDING NEW ONES] */
        .survey-card {
            background: linear-gradient(135deg, rgba(46, 204, 113, 0.1), rgba(39, 174, 96, 0.1));
            border: 2px solid rgba(46, 204, 113, 0.3);
            border-radius: 20px;
            padding: 35px;
            margin-bottom: 28px;
        }

        .survey-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 24px;
            margin-bottom: 30px;
        }

        .survey-stat {
            text-align: center;
            padding: 25px;
            background: rgba(255, 255, 255, 0.9);
            border-radius: 16px;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.08);
        }

        .survey-stat-value {
            font-size: 2.8em;
            font-weight: 800;
            color: #2ecc71;
            line-height: 1;
        }

        .survey-stat-label {
            color: #5a6c7d;
            font-weight: 600;
            margin-top: 8px;
            font-size: 1em;
        }

        .analytics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 28px;
            margin-bottom: 40px;
        }

        .analytics-card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            padding: 35px;
            border-radius: 20px;
            box-shadow: 0 12px 40px rgba(0, 0, 0, 0.1);
            border-top: 5px solid #9b59b6;
        }

        .comparison-chart {
            height: 280px !important;
        }
    </style>
</head>
<body>
    <!-- [KEEP ALL PREVIOUS HTML STRUCTURE] -->
    
    <!-- ADD NEW TABS -->
    <div class="tabs">
        <button class="tab active" onclick="switchTab(0)">üìä Overview</button>
        <button class="tab" onclick="switchTab(1)">üë• Patients</button>
        <button class="tab" onclick="switchTab(2)">üìà Analytics</button>
        <button class="tab" onclick="switchTab(3)">üìã Reports</button>
        <button class="tab" onclick="switchTab(4)">üìä Survey</button> <!-- NEW SURVEY TAB -->
        <button class="tab" onclick="switchTab(5)">üéØ Insights</button> <!-- NEW ANALYTICS TAB -->
    </div>

    <!-- NEW TAB 4: PATIENT SURVEY REPORT -->
    <div id="tab4" class="tab-content">
        <h2 class="section-title">Patient Satisfaction Survey</h2>
        <p style="color: white; font-size: 1.2em; margin-bottom: 30px; text-align: center; max-width: 800px; margin-left: auto; margin-right: auto;">
            92% of NeuroCPAP users report <strong>better compliance</strong> vs traditional CPAP (85% abandonment rate)
        </p>

        <div class="survey-card">
            <div class="survey-stats">
                <div class="survey-stat">
                    <div class="survey-stat-value">92%</div>
                    <div class="survey-stat-label">Comfort Rating</div>
                </div>
                <div class="survey-stat">
                    <div class="survey-stat-value">89%</div>
                    <div class="survey-stat-label">Would Recommend</div>
                </div>
                <div class="survey-stat">
                    <div class="survey-stat-value">4.8‚≠ê</div>
                    <div class="survey-stat-label">Avg Rating</div>
                </div>
                <div class="survey-stat">
                    <div class="survey-stat-value">78%</div>
                    <div class="survey-stat-label">Nightly Usage</div>
                </div>
            </div>

            <div class="chart-card" style="margin-top: 30px;">
                <div class="chart-title">Patient Satisfaction vs Traditional CPAP</div>
                <canvas id="surveyComparisonChart" class="comparison-chart"></canvas>
            </div>
        </div>

        <div style="background: rgba(255, 255, 255, 0.95); backdrop-filter: blur(20px); padding: 35px; border-radius: 20px; box-shadow: 0 12px 40px rgba(0, 0, 0, 0.1);">
            <h3 style="color: #1e3c72; font-size: 1.8em; margin-bottom: 20px; font-weight: 700;">üìù Latest Patient Feedback</h3>
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px;">
                <div style="padding: 25px; background: linear-gradient(135deg, #f8f9fa, #e9ecef); border-radius: 16px; border-left: 5px solid #2ecc71;">
                    <p style="font-style: italic; color: #2c3e50; margin-bottom: 15px;">"Finally sleeping through the night without waking up gasping! The auto-adjust is magical."</p>
                    <div style="font-weight: 700; color: #2ecc71;">‚Äî Rajesh Kumar, 45</div>
                </div>
                <div style="padding: 25px; background: linear-gradient(135deg, #f8f9fa, #e9ecef); border-radius: 16px; border-left: 5px solid #3498db;">
                    <p style="font-style: italic; color: #2c3e50; margin-bottom: 15px;">"Much quieter and comfortable than my old CPAP. My energy levels are back!"</p>
                    <div style="font-weight: 700; color: #3498db;">‚Äî Priya Sharma, 38</div>
                </div>
            </div>
        </div>
    </div>

    <!-- NEW TAB 5: ADVANCED ANALYTICS -->
    <div id="tab5" class="tab-content">
        <h2 class="section-title">Advanced Analytics Dashboard</h2>
        
        <div class="analytics-grid">
            <div class="analytics-card">
                <h3 style="color: #9b59b6; margin-bottom: 20px; font-size: 1.4em;">OSA vs CSA Detection Accuracy</h3>
                <canvas id="osaCsaAccuracyChart" style="height: 280px;"></canvas>
            </div>
            
            <div class="analytics-card">
                <h3 style="color: #9b59b6; margin-bottom: 20px; font-size: 1.4em;">Therapy Effectiveness (AHI Reduction)</h3>
                <canvas id="ahiReductionChart" style="height: 280px;"></canvas>
            </div>
            
            <div class="analytics-card">
                <h3 style="color: #9b59b6; margin-bottom: 20px; font-size: 1.4em;">Compliance Rate Improvement</h3>
                <canvas id="complianceChart" style="height: 280px;"></canvas>
            </div>
            
            <div class="analytics-card">
                <div style="text-align: center; padding: 40px;">
                    <div style="font-size: 4em; color: #2ecc71; margin-bottom: 20px;">üìà</div>
                    <h3 style="color: #9b59b6; margin-bottom: 15px;">95.2%</h3>
                    <p style="color: #5a6c7d; font-size: 1.1em; font-weight: 600;">Overall System Accuracy<br><small>vs Gold Standard PSG</small></p>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ADD NEW CHARTS TO createCharts() function
        let surveyChartInstance = null;
        let osaCsaChartInstance = null;
        let ahiChartInstance = null;
        let complianceChartInstance = null;

        // UPDATE switchTab function to handle 6 tabs (0-5)
        function switchTab(index) {
            const tabs = document.querySelectorAll('.tab');
            const contents = document.querySelectorAll('.tab-content');
            
            tabs.forEach((tab, i) => tab.classList.toggle('active', i === index));
            contents.forEach((content, i) => content.classList.toggle('active', i === index));
        }

        // UPDATE initDashboard()
        function initDashboard() {
            renderPatients('patientsOverview', 6);
            renderPatients('allPatients');
            renderEventsTable();
            createCharts();
        }

        // ENHANCED createCharts() with NEW charts
        function createCharts() {
            // [KEEP ALL PREVIOUS CHARTS]

            // NEW: Survey Comparison Chart
            const surveyCtx = document.getElementById('surveyComparisonChart')?.getContext('2d');
            if (surveyCtx && surveyChartInstance) surveyChartInstance.destroy();
            if (surveyCtx) {
                surveyChartInstance = new Chart(surveyCtx, {
                    type: 'bar',
                    data: {
                        labels: ['Comfort', 'Compliance', 'Noise', 'Portability'],
                        datasets: [{
                            label: 'NeuroCPAP',
                            data: [92, 89, 87, 91],
                            backgroundColor: 'rgba(46, 204, 113, 0.8)',
                            borderRadius: 12,
                            borderWidth: 0
                        }, {
                            label: 'Traditional CPAP',
                            data: [62, 45, 58, 51],
                            backgroundColor: 'rgba(231, 76, 60, 0.6)',
                            borderRadius: 12,
                            borderWidth: 0
                        }]
                    },
                    options: {
                        responsive: true,
                        plugins: {
                            legend: { position: 'top' }
                        },
                        scales: {
                            y: { beginAtZero: true, max: 100 }
                        }
                    }
                });
            }

            // NEW: OSA vs CSA Accuracy
            const osaCsaCtx = document.getElementById('osaCsaAccuracyChart')?.getContext('2d');
            if (osaCsaCtx && osaCsaChartInstance) osaCsaChartInstance.destroy();
            if (osaCsaCtx) {
                osaCsaChartInstance = new Chart(osaCsaCtx, {
                    type: 'doughnut',
                    data: {
                        labels: ['OSA Detection', 'CSA Detection', 'Mixed Apnea'],
                        datasets: [{
                            data: [97, 94, 92],
                            backgroundColor: ['#3498db', '#e74c3c', '#f39c12'],
                            borderWidth: 3,
                            borderColor: '#fff'
                        }]
                    },
                    options: {
                        responsive: true,
                        plugins: {
                            legend: { position: 'bottom' },
                            title: { display: true, text: 'Accuracy vs PSG (Gold Standard)' }
                        }
                    }
                });
            }

            // NEW: AHI Reduction
            const ahiCtx = document.getElementById('ahiReductionChart')?.getContext('2d');
            if (ahiCtx && ahiChartInstance) ahiChartInstance.destroy();
            if (ahiCtx) {
                ahiChartInstance = new Chart(ahiCtx, {
                    type: 'line',
                    data: {
                        labels: ['Week 1', 'Week 2', 'Week 3', 'Week 4'],
                        datasets: [{
                            label: 'AHI (Events/Hour)',
                            data: [28, 18, 12, 7],
                            borderColor: '#2ecc71',
                            backgroundColor: 'rgba(46, 204, 113, 0.1)',
                            tension: 0.4,
                            fill: true,
                            borderWidth: 4
                        }]
                    },
                    options: {
                        responsive: true,
                        scales: { y: { beginAtZero: true } }
                    }
                });
            }

            // NEW: Compliance Rate
            const complianceCtx = document.getElementById('complianceChart')?.getContext('2d');
            if (complianceCtx && complianceChartInstance) complianceChartInstance.destroy();
            if (complianceCtx) {
                complianceChartInstance = new Chart(complianceCtx, {
                    type: 'radar',
                    data: {
                        labels: ['Night 1', 'Night 2', 'Night 3', 'Night 4', 'Night 5', 'Night 6', 'Night 7'],
                        datasets: [{
                            label: 'Usage Hours',
                            data: [6.2, 6.8, 7.1, 7.4, 7.8, 8.1, 8.3],
                            borderColor: '#9b59b6',
                            backgroundColor: 'rgba(155, 89, 182, 0.2)',
                            borderWidth: 3,
                            pointBackgroundColor: '#9b59b6'
                        }]
                    },
                    options: {
                        responsive: true,
                        scales: {
                            r: {
                                beginAtZero: true,
                                max: 9,
                                ticks: { stepSize: 1 }
                            }
                        }
                    }
                });
            }
        }
    </script>
</body>
</html>
